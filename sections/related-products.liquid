{%- liquid 
  capture icon_arrow_list
    render 'icon-arrow-list'
  endcapture

  assign item_to_show_desktop = section.settings.carousel_number
  assign item_to_show_tablet = item_to_show_desktop | minus: 1
  assign item_to_show_mobile = item_to_show_tablet | minus: 1
  if item_to_show_desktop < 3
    assign item_to_show_tablet = item_to_show_desktop
    assign item_to_show_mobile = item_to_show_tablet | minus: 1
  endif
  if item_to_show_tablet < 2
    assign item_to_show_mobile = item_to_show_tablet
  endif
-%}
<div class="section__f-collection style-collection-{{ settings.arrow_style }} section__r-product spacing spacing-xs pos-relative color-{{ section.settings.color_scheme }} gradient no-js-hidden"
  style="--padding-top: {{ section.settings.padding_top }}px;
    --padding-bottom: {{ section.settings.padding_bottom }}px;
    --padding-top-xs: {{ section.settings.padding_top_mobile }}px;
    --padding-bottom-xs: {{ section.settings.padding_bottom_mobile }}px;"
>
  <product-recommendations class="related-products d-block" data-url="{{ routes.product_recommendations_url }}?section_id={{ section.id }}&product_id={{ product.id }}&limit={{ section.settings.products_to_show }}">
    <div class="page-width m-auto">
      {%- if recommendations.performed and recommendations.products_count > 0 -%}
        {%- if section.settings.heading != blank -%}
          <div class="p-w__header">
            <div class="p-w__header--wrapper left">
              <h2 id="SectionHeading-{{ section.id }}" class="p-w__heading m-0{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %} {% render 'heading-style', settings: section.settings, type: 'class' %}" style="{% render 'heading-style', settings: section.settings, type: 'style' %}">
                {{ section.settings.heading | escape }}
              </h2>
            </div>
          </div>
        {%- endif -%}
        <div class="p-w__content">
          <slider-component class="carousel d-block pos-relative{% if section.settings.carousel_infinite_scroll %} infinite-scroll{% endif %}" data-space-between="10" data-type-pagination="{{ section.settings.pagination_type }}" data-item-to-show-desktop="{{ item_to_show_desktop }}" data-item-to-show-tablet="{{ item_to_show_tablet }}" data-item-to-show-mobile="{{ item_to_show_mobile }}">
            <div class="swiper grid-scroll d-block pos-relative no-js-overflow-x">
              <div class="swiper-wrapper" style="--c-xs: 1; --c-sm: 2; --c-md: 3; --c-lg: 4;">
                {%- for recommendation in recommendations.products -%}
                  <div role="listitem" id="Slide-{{ section.id }}-{{ forloop.index }}" class="carousel__item swiper-slide no-js-grid__item no-js-grid__scroll{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
                    {% if settings.animations_reveal_on_scroll %}
                      style="--animation-order: {{ forloop.index }};"
                    {% endif %}
                  >
                    {% render 'card-product',
                      card_product: recommendation,
                      media_aspect_ratio: settings.card_image_ratio,
                      show_secondary_image: settings.show_secondary_image,
                      show_vendor: settings.show_vendor_product,
                      show_vendor_mobile: settings.show_vendor_mobile,
                      show_rating: settings.show_rating_product,
                      show_rating_mobile: settings.show_rating_mobile,
                      show_quick_add: settings.enable_quick_add,
                      show_quick_add_mobile: settings.enable_quick_add_mobile,
                      show_swatch: settings.show_swatch,
                      show_swatch_mobile: settings.show_swatch_mobile,
                      card_button_text_size: settings.card_button_text_size,
                      card_button_type: settings.card_button_type,
                      card_button_transform: settings.card_button_transform,
                      index: forloop.index,
                      section_id: section.id
                    %}
                  </div>
                {%- endfor -%}
              </div>
              <div class="carousel__controls arrow-style-{{ settings.arrow_style }} no-js-hidden">
                {%- if section.settings.arrows_type != 'none' and settings.arrow_style == 'modern-plus' -%}
                  <div class="arrow-wrap d-flex pos-absolute swiper-screen__{{ section.settings.arrows_type }}">
                {%- endif -%}
                  {%- if section.settings.arrows_type != 'none' -%}
                    <button type="button" data-step="1" class="button-slider button-slider__prev swiper-screen__{{ section.settings.arrows_type }}{% if settings.arrow_style != 'modern-plus' %} button-slider__hover{% endif %} color-arrow t-button b-none c-pointer pos-absolute z-index-2 b-circle p-0 d-flex a-i-center j-c-center swiper-button-prev" aria-label="{{ 'accessibility.previous_slide' | t }}" aria-controls="Slider-{{ section.id }}" name="previous">
                      {{ icon_arrow_list }}
                    </button>
                    <button type="button" data-step="1" class="button-slider button-slider__next swiper-screen__{{ section.settings.arrows_type }}{% if settings.arrow_style != 'modern-plus' %} button-slider__hover{% endif %} color-arrow t-button b-none c-pointer pos-absolute z-index-2 b-circle p-0 d-flex a-i-center j-c-center swiper-button-next" aria-label="{{ 'accessibility.next_slide' | t }}" aria-controls="Slider-{{ section.id }}" name="next">
                      {{ icon_arrow_list }}
                    </button>
                  {%- endif -%}
                {%- if section.settings.arrows_type != 'none' and settings.arrow_style == 'modern-plus' -%}
                    <div class="mask-overlay pos-absolute top-0 left-0"></div>
                  </div>
                {%- endif -%}
                <div class="swiper-pagination swiper-screen__{{ section.settings.enable_pagination_type }} pos-relative"></div>
              </div>
            </div>
          </slider-component>
        </div>
      {%- endif -%}
    </div>
  </product-recommendations>
</div>

{%- if settings.enable_quick_add or settings.enable_quick_add_mobile -%}
  {%- assign files = "quick-add.js, product-form.js" | split: ', ' -%}
  {% render 'theme-loader', files: files %}
{%- endif -%}

{% schema %}
{
  "name": "t:sections.related-products.name",
  "tag": "section",
  "class": "section",
  "settings": [
  {
    "type": "paragraph",
    "content": "t:sections.related-products.settings.paragraph__1.content"
  },
  {
    "type": "text",
    "id": "heading",
    "default": "Related Products",
    "label": "t:sections.all.heading.label"
  },
  {
    "type": "checkbox",
    "id": "use_custom_heading",
    "default": false,
    "label": "Use custom heading",
    "visible_if": "{{ section.settings.heading != blank }}"
  },
  {
    "type": "range",
    "id": "custom_heading_size",
    "min": 12,
    "max": 110,
    "step": 1,
    "unit": "px",
    "default": 82,
    "label": "Custom heading size",
    "visible_if": "{{ section.settings.use_custom_heading and section.settings.heading != blank }}"
  },
  {
    "type": "color",
    "id": "custom_heading_color",
    "default": "#898d9a",
    "label": "Custom heading color",
    "visible_if": "{{ section.settings.use_custom_heading and section.settings.heading != blank }}"
  },
  {
    "type": "range",
    "id": "custom_heading_leading",
    "min": 0.5,
    "max": 2,
    "step": 0.1,
    "unit": "px",
    "default": 1.1,
    "label": "Leading",
    "visible_if": "{{ section.settings.use_custom_heading and section.settings.heading != blank }}"
  },
  {
    "type": "range",
    "id": "custom_heading_tracking",
    "min": -5,
    "max": 5,
    "step": 0.1,
    "unit": "px",
    "default": 0,
    "label": "Tracking",
    "visible_if": "{{ section.settings.use_custom_heading and section.settings.heading != blank }}"
  },
  {
    "type": "range",
    "id": "custom_heading_word_spacing",
    "min": -5,
    "max": 5,
    "step": 0.1,
    "unit": "px",
    "default": 0,
    "label": "Word spacing",
    "visible_if": "{{ section.settings.use_custom_heading and section.settings.heading != blank }}"
  },
  {
    "type": "checkbox",
    "id": "use_custom_heading_font",
    "default": false,
    "label": "Use custom heading font",
    "visible_if": "{{ section.settings.use_custom_heading and section.settings.heading != blank }}"
  },
  {
    "type": "range",
    "id": "products_to_show",
    "min": 2,
    "max": 10,
    "step": 1,
    "default": 6,
    "label": "t:sections.all.product.product_list_limit"
  },
  {
    "type": "color_scheme",
    "id": "color_scheme",
    "label": "t:sections.all.colors.label",
    "default": "background-1"
  },
  {
    "type": "header",
    "content": "t:sections.all.carousel.label"
  },
  {
    "type": "select",
    "id": "arrows_type",
    "options": [
      {
        "value": "none",
        "label": "t:sections.all.carousel.arrows.options"
      },
      {
        "value": "all",
        "label": "t:sections.all.carousel.arrows.options__1"
      },
      {
        "value": "lg",
        "label": "t:sections.all.carousel.arrows.options__2"
      },
      {
        "value": "md",
        "label": "t:sections.all.carousel.arrows.options__3"
      },
      {
        "value": "sm",
        "label": "t:sections.all.carousel.arrows.options__4"
      },
      {
        "value": "xs",
        "label": "t:sections.all.carousel.arrows.options__5"
      }],
    "default": "all",
    "label": "t:sections.all.carousel.arrows.label"
  },
  {
    "type": "checkbox",
    "id": "carousel_infinite_scroll",
    "default": false,
    "label": "t:sections.all.carousel.heading_1"
  },
  {
    "type": "range",
    "id": "carousel_number",
    "min": 3,
    "max": 6,
    "step": 0.2,
    "label": "t:sections.all.carousel.heading_2",
    "default": 4.2
  },
  {
    "type": "select",
    "id": "enable_pagination_type",
    "options": [
      {
        "value": "all",
        "label": "t:sections.all.carousel.arrows.options__1"
      },
      {
        "value": "lg",
        "label": "t:sections.all.carousel.arrows.options__2"
      },
      {
        "value": "md",
        "label": "t:sections.all.carousel.arrows.options__3"
      },
      {
        "value": "sm",
        "label": "t:sections.all.carousel.arrows.options__4"
      },
      {
        "value": "xs",
        "label": "t:sections.all.carousel.arrows.options__5"
      }],
    "default": "all",
    "label": "t:sections.all.carousel.pagination.label__1"
  },
  {
    "type": "select",
    "id": "pagination_type",
    "options": [
      {
        "value": "none",
        "label": "t:sections.all.carousel.pagination.options"
      },
      {
        "value": "dots",
        "label": "t:sections.all.carousel.pagination.options__1"
      },
      {
        "value": "progressbar",
        "label": "t:sections.all.carousel.pagination.options__2"
      },
      {
        "value": "fraction",
        "label": "t:sections.all.carousel.pagination.options__3"
      }],
    "default": "progressbar",
    "label": "t:sections.all.carousel.pagination.label"
  },
  {
    "type": "header",
    "content": "t:sections.all.padding.section_padding_heading"
  },
  {
    "type": "range",
    "id": "padding_top",
    "min": 0,
    "max": 100,
    "step": 1,
    "unit": "px",
    "label": "t:sections.all.padding.padding_top",
    "default": 78
  },
  {
    "type": "range",
    "id": "padding_bottom",
    "min": 0,
    "max": 100,
    "step": 1,
    "unit": "px",
    "label": "t:sections.all.padding.padding_bottom",
    "default": 36
  },
  {
    "type": "range",
    "id": "padding_top_mobile",
    "min": 0,
    "max": 100,
    "step": 1,
    "unit": "px",
    "label": "t:sections.all.padding.padding_top_mobile",
    "default": 35
  },
  {
    "type": "range",
    "id": "padding_bottom_mobile",
    "min": 0,
    "max": 100,
    "step": 1,
    "unit": "px",
    "label": "t:sections.all.padding.padding_bottom_mobile",
    "default": 15
  }]
}
{% endschema %}
